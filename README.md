# snctl-cpp

The CLI tool to manage clusters on StreamNative Cloud.

## Build

You must have a C++ compiler that supports C++17.

```bash
git submodule update --init --recursive
cmake -B build
cmake --build build
```

Then you can find the executable in `build/snctl-cpp`.

## How to use

You only need to fill the following fields in `sncloud.ini` (make sure this file exists in the current work directory):
- `bootstrap.servers`: the URL of the Kafka service, e.g. `pc-xxx:9093` on StreamNative cloud.
- (optional) `token`: the token generated by the API key. It's allowed to be empty for quickly testing against a local Kafka cluster without any authentication.

Run `./build/snctl-cpp -h` to see the help message.

Options:
- Add the `--config <config-file>` option to specify a different path of the INI config file.
- Add a `--client-id` option to specify the client id of the underlying Kafka client. In Ursa, the client id carries the zone information, see [here](https://docs.streamnative.io/docs/config-kafka-client#eliminate-cross-az-networking-traffic).

### Describe a topic

Query the owner brokers for all partitions:

```bash
$ ./build/snctl-cpp describe <topic>
Partition[0] leader: { "id": "816909419, url: "pb0-<xxx>:9093"}"
Partition[1] leader: { "id": "101337027, url: "pb4-<xxx>:9093"}"
...
Partition[15] leader: { "id": "644587507, url: "pb2-<xxx>:9093"}"
```

Query the owner brokers for all partitions in a specific zone (`use1-az1` in this case):

```bash
$ ./build/snctl-cpp --client-id zone_id=use1-az1 describe <topic>
Partition[0] leader: { "id": "1868363245, url: "pb5-<xxx>:9093"}
Partition[1] leader: { "id": "1868363245, url: "pb5-<xxx>:9093"}
...
Partition[15] leader: { "id": "644587507, url: "pb2-<xxx>:9093"}
```

As you can see, when a client specifies `use1-az1` as its zone, only brokers in the same zone (`pb2` and `pb5`) will serve the requests from that client.
